#!/bin/bash

LIB_PATH=$( dirname $0 )/../lib/script
source $LIB_PATH/script_helper.sh

USER_ARGS=$@
ARCH=$( system_architecture $USER_ARGS )
PLATFORM=$( system_os $USER_ARGS )


if [ -z $ARCH ]; then
  if [ -f $CFG_PATH/.arch ]; then
    ARCH=$( cat $CFG_PATH/.arch )
  else
    ARCH=$( syatem_architecture )
  fi
fi
if [ -z $PLATFORM ]; then
  if [ -f $CFG_PATH/.os ]; then
    PLATFORM=$( cat $CFG_PATH/.os )
  else
    PLATFORM=$( system_os )
  fi

fi

echo -n $ARCH > $CFG_PATH/.arch
echo -n $PLATFORM > $CFG_PATH/.os

SYMLINK_SOURCE=$( ls -d $RES_PATH/pkg/nwjs-v* | grep $PLATFORM | grep $ARCH | sed -e '/\(.tar.gz\|\.zip\)/d' )

rm --force --verbose $RES_PATH/nwjs
ln --symbolic --force --verbose $SYMLINK_SOURCE $RES_PATH/nwjs



exit $EXITCODE_SUCCESS
