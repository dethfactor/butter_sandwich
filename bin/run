#!/bin/bash --login

LIB_PATH=$( dirname $0 )/../lib/script
source $LIB_PATH/script_helper.sh

ENTRY_POINT_JS=$( abs_path $1 )
PROJECT_NAME=$( basename $ENTRY_POINT_JS .js )


if [ ! -r $TMP_PATH/../.${PROJECT_NAME}.recent_build ]; then
  $BIN_PATH/build $ENTRY_POINT_JS $USER_PATH
fi

BUILD_ID=$( cat $TMP_PATH/.${PROJECT_NAME}.recent_build )
OUTPUT_FILE=$TMP_PATH/$BUILD_ID/$PROJECT_NAME-${BUILD_ID}.nw

$BIN_PATH/nw $OUTPUT_FILE ./$( basename $ENTRY_POINT_JS )
EXITCODE=$?

cd $USER_PATH
exit $EXITCODE
