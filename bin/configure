#!/bin/bash --login


LIB_PATH=$( dirname $0 )/../lib/script
source $LIB_PATH/script_helper.sh

$RES_PATH/pkg/populate


cd $RES_PATH/pkg
for archive in $( ls *.tar.gz *.zip ); do
  if [ "$( is_tar $archive )" == 'true' ]; then
    tar --extract --verbose --keep-old-files --keep-directory-symlink --no-overwrite-dir --file=./$archive
  elif [ "$( is_zip $archive )" == 'true' ]; then
    unzip -u -o $archive -d $RES_PATH/pkg/
  fi
done


if [ -f $CFG_PATH/.arch ]; then
  ARCH=$( cat $CFG_PATH/.arch )
fi
if [ -f $CFG_PATH/.os ]; then
  PLATFORM=$( cat $CFG_PATH/.os )
fi

$BIN_PATH/set_platform $PLATFORM $ARCH


touch $ROOT_PATH/.configured

cd $USER_PATH
exit $EXITCODE_SUCCESS
